[![Build status](https://ci.appveyor.com/api/projects/status/uwhg9nwo62kx2fif?svg=true)](https://ci.appveyor.com/project/cjbhaines/signalr-hubs-typescriptgenerator)

# Signalr.Hubs.TypeScriptGenerator
Utility library for generating typescript definitions for Signalr Hubs. This is a fork of [yetanotherchris/SignalrTypeScriptGenerator](https://github.com/yetanotherchris/SignalrTypeScriptGenerator "SignalrTypeScriptGenerator") by [yetanotherchris](https://github.com/yetanotherchris "yetanotherchris"). I have split the packages up into a referenced library and a console app.

Our usage at Genius Sports is to generate the Hub proxies at build time using our [geniussportsgroup/SignalR.ProxyGenerator](https://github.com/geniussportsgroup/SignalR.ProxyGenerator "Proxy Generator") publishing them to our internal NPM feed. We then use this tool to generate TypeScript definitions our those proxies again publishing them to our internal NPM feed. This allows our UI developers to get strongly typed Hub APIs and allows us to do proper Continous Integrtaion between the back end and front end. Move quickly and break fast.


## Installation - Nuget

- [Signalr.Hubs.TypeScriptGenerator](https://www.nuget.org/packages/Signalr.Hubs.TypeScriptGenerator "Signalr.Hubs.TypeScriptGenerator")
- [Signalr.Hubs.TypeScriptGenerator.Console](https://www.nuget.org/packages/Signalr.Hubs.TypeScriptGenerator.Console "Signalr.Hubs.TypeScriptGenerator.Console")

## Usage

### Signalr.Hubs.TypeScriptGenerator
The utility library is simple to use, load any assemblies required and then create a HubTypeScriptGenerator and call Generate. It returns the TypeScript as a string. We can't pick a specific assembly to scan because we are using the SignalR DefaultHubManager which looks in all loaded assemblies.

	var generator = new HubTypeScriptGenerator();
	var typeScript = generator.Generate();


### Signalr.Hubs.TypeScriptGenerator.Console
This will output the TypeScript to the specified file path

    .\Signalr.Hubs.TypeScriptGenerator.Console.exe -a "c:\etc\path-to-myassembly.dll" -o "C:\temp\.myfile.d.ts"

If the output file is not specified the result is written to standard out.

**# ONLY COMBATIBLE WITH SIGNALR VERSIONS AT 2.2.1.0 OR EARLIER #**

We have compiled this at verison 2.2.1.0 so in order for the HubManager to recognise your hubs we are using an assembly redirect. If Microsoft release a new version we will need to update this.
 
	<dependentAssembly>
        <assemblyIdentity name="Microsoft.AspNet.SignalR.Core" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-2.2.1.0" newVersion="2.2.1.0" />
      </dependentAssembly>

### Data Contract Property Name
Sometimes the serialized name of your data contract properties are changed from the actual C# property name. This is done through the DataMember property:

    [DataContract]
    public class SomethingDto
    {
        [DataMember(Name = "iChangedTheName")]
        public string Property1 { get; set; }

        [DataMember]
        public Guid Property2 { get; set; }
    }

This library will respect the DataMember name and use this as the TypeScript property name:
	
	declare module GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts
	{
		interface SomethingDto
		{
			iChangedTheName : string;
			Property2 : System.Guid;
		}
	}

## Example Output


	/// Autogenerated at 16/09/2016 13:22:56 by https://github.com/geniussportsgroup/Signalr.Hubs.TypeScriptGenerator
	/// <reference path="../signalr/index.d.ts" />
	/// <reference path="../jquery/index.d.ts" />
	
	// Hubs
	interface SignalR
	{
		hubA : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs.HubA;
		hubC : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs.HubC;
		hubB : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs.HubB;
	}
	
	// Service contracts
	
	declare module GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs
	{
	
		interface HubA
		{
	        server : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs.HubAServer;
	        client : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs.IHubAClient;
	    }
	
		interface HubAServer
		{
			getSomething() : JQueryPromise<GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts.SomethingDto>;
			ping() : JQueryPromise<void>;
		}
	}
	
	
	declare module GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs
	{
	
		interface HubC
		{
	        server : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs.HubCServer;
	        // Hub does not have a Client Interface as a generic argument - it is recommend to add one
	        client : any;
	    }
	
		interface HubCServer
		{
			aServerSideMethod() : JQueryPromise<void>;
		}
	}
	
	
	declare module GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs
	{
	
		interface HubB
		{
	        server : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs.HubBServer;
	        client : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs.IHubBClient;
	    }
	
		interface HubBServer
		{
			getOtherSomething() : JQueryPromise<GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts.OtherSomethingDto>;
			doOtherSomethingElse() : JQueryPromise<void>;
		}
	}
	
	
	// Clients
	
	declare module GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs
	{
		interface IHubAClient
		{
			pong : () => void;
			takeThis : (somethingDto : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts.SomethingDto) => void;
		}
	}
	
	
	declare module GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.Hubs
	{
		interface IHubBClient
		{
			takeOtherThis : (otherSomethingDto : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts.OtherSomethingDto) => void;
		}
	}
	
	
	// Data contracts
	
	declare module GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts
	{
		interface OtherSomethingDto
		{
			Property1 : string;
			Property2 : Date;
			Property3 : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts.InnerSomethingDto;
			Property4 : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts.InnerSomethingDto;
		}
	}
	
	
	declare module GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts
	{
		interface InnerSomethingDto
		{
			InnerProperty1 : number;
			innerProperty2 : Date;
			innerProperty3WithCrazyCustomName : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts.SomethingEnum;
		}
	}
	
	
	declare module GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts
	{
		interface SomethingDto
		{
			iChangedTheName : string;
			Property2 : System.Guid;
			Property3 : GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts.InnerSomethingDto;
		}
	}
	
	
	declare module System
	{
		interface Guid
		{
		}
	}
	
	
	// Enums
	
	declare module GeniusSports.Signalr.Hubs.TypeScriptGenerator.SampleUsage.DataContracts
	{
		enum SomethingEnum
		{
			One = 0,
			Two = 1,
			Three = 2,
		}
	}
	
	
